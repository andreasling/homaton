<!DOCTYPE html>
<html manifest="homaton.appcache">
  <head>
    <title>Light Switches</title>
    <meta name="viewport" content="width=200, initial-scale=1.5, maximum-scale=1.5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="icon.png" />
    <link href="dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="shortcut icon" href="icon.png" type="image/png">
    <style type="text/css">
.input-group .input-group-addon { width: 80px; }
div.row { margin-bottom: 0.5em; }
.btn-inverse {
  color: white;
  background-color: #555;
  border-color: #888;
}
h3 {
  font-variant: small-caps;
  font-weight: bold;
}
#alert-message {
  margin-top: 1em;
  font-size: xx-small;
}
    </style>
  </head>
  <body>
    <div id="alert" class="hide alert alert-danger alert-dismissible" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <strong>Oh snap!</strong> Something went wrong! :(
      <div id="alert-message">...</div>
    </div>
    <div class="container">
      <form method="post">
        <div class="row">
          <div class="col-xs-12">
            <div class="header">
              <legend><h3>Light Switches</h3></legend>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12">
            <div class="input-group">
              <span class="input-group-addon">matsal</span>
              <span class="input-group-btn">
                <button type="submit" name="command" data-switch="1" data-state="on"  class="btn btn-default"><div>on</div></button>
                <button type="submit" name="command" data-switch="1" data-state="off" class="btn btn-inverse">off</button>
              </span>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12">
            <div class="input-group">
              <span class="input-group-addon">trappa</span>
              <span class="input-group-btn">
                <button type="submit" name="command" data-switch="2" data-state="on"  class="btn btn-default">on</button>
                <button type="submit" name="command" data-switch="2" data-state="off" class="btn btn-inverse">off</button>
              </span>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12">
            <div class="input-group">
              <span class="input-group-addon">baksida</span>
              <span class="input-group-btn">
                <button type="submit" name="command" data-switch="3" data-state="on"  class="btn btn-default">on</button>
                <button type="submit" name="command" data-switch="3" data-state="off" class="btn btn-inverse">off</button>
              </span>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12">
            <div class="input-group">
              <span class="input-group-addon">sovrum</span>
              <span class="input-group-btn">
                <button type="submit" name="command" data-switch="4" data-state="on"  class="btn btn-default">on</button>
                <button type="submit" name="command" data-switch="4" data-state="off" class="btn btn-inverse">off</button>
              </span>
            </div>
          </div>
        </div>
      </form>
    </div>
    <script type="text/javascript">

var alertElement = document.getElementById("alert");
var alertMessageElement = document.getElementById("alert-message");

document.querySelectorAll('button[name="command"]').forEach(button => {
  button.onclick = e => {

    e.preventDefault();

    var button = e.currentTarget;
    var switchNumber = parseInt(button.dataset.switch);
    var state = button.dataset.state;

    console.log(switchNumber, state);

    fetch(`api/${switchNumber}`, {
      method: "POST",
      body: state
    }).then(response => {
      if (response.ok) {
        return response.text();
      } else {
        console.error(response.status, response.statusText);
        alertMessageElement.innerText = `${response.status}: ${response.statusText}`;
        alertElement.classList.remove("hide");
      }
    }).then(text => {
      console.log(text);
    }).catch(error => {
      console.error(error);
      alertMessageElement.innerText = `${error.message}`;
      alertElement.classList.remove("hide");
    });
  };
});

alertElement.querySelector("button.close").onclick = e => {
  alertElement.classList.add("hide");
  alertMessageElement.innerText = "";
};

    </script>
  </body>
</html>
